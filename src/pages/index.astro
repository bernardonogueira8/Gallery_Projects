---
import { getCollection } from 'astro:content';
import ProjectCard from '../components/ProjectCard.astro';
import Layout from '../layouts/Layout.astro';
import "../styles/global.css";

const allProjects = await getCollection('projects');

// Pega todos os tipos únicos para criar os botões
const types = ['Todos', ...new Set(allProjects.map((p) => p.data.type))];
---

<Layout title="Meu Portfólio de Dashboards">
  <main class="p-8 max-w-7xl mx-auto">
    <header class="mb-4 flex flex-row items-start justify-between">
      <h1 class="text-2xl font-bold border-l-4 border-success px-4 uppercase tracking-tighter mb-4">
        Painéis de Power BI e Códigos
        
      </h1>
      
      <div class="flex flex-wrap gap-2 mb-8">
        {types.map((type) => (
          <button 
            class="btn btn-outline btn-success btn-sm filter-btn" 
            data-filter={type}
          >
            {type}
          </button>
        ))}
      </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-8" id="project-grid">
      {allProjects.map((project) => (
        <div class="project-item" data-type={project.data.type}>
          <ProjectCard 
            title={project.data.title}
            image={project.data.image}
            objectives={project.data.objectives}
            link={project.data.link}
          />
        </div>
      ))}
    </div>
  </main>
</Layout>

<script>
  const buttons = document.querySelectorAll('.filter-btn');
  const projects = document.querySelectorAll('.project-item');

  buttons.forEach(button => {
    button.addEventListener('click', () => {
      const filter = button.getAttribute('data-filter');

      // Atualiza estilo dos botões (daisyUI)
      buttons.forEach(btn => btn.classList.remove('btn-active'));
      button.classList.add('btn-active');

      // Lógica de esconder/mostrar
      projects.forEach(project => {
        const projectType = project.getAttribute('data-type');
        if (filter === 'Todos' || projectType === filter) {
          (project as HTMLElement).style.display = 'block';
        } else {
          (project as HTMLElement).style.display = 'none';
        }
      });
    });
  });
</script>